/*! pipeline - v0.0.1 - 2014-04-23
* Copyright (c) 2014 Ryan Artecona; Licensed BSD-3-Clause */
!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.PL=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c=a("./assert"),d=function(a){this.init(a)};d.prototype.isBroken=!1,d.prototype._userBreakHandler=function(){},d.prototype.init=function(a){c("function"==typeof a,"Bond can only be constructed with a break handler function."),this._userBreakHandler=a},d.prototype.break=function(){this.isBroken||(this.isBroken=!0,this._userBreakHandler(),delete this.userBreakHandler)},b.exports=d},{"./assert":9}],2:[function(a,b){var c=a("./assert"),d=(a("./Pipe"),a("./Inlet")),e=(a("./schedulers"),function(a){return"undefined"==typeof a&&(a=0),c("number"==typeof a&&a>=0,"HistoryInlet can only be constructed with an integer capacity."),this.capacity=Math.floor(a),this});e.prototype=new d,e.prototype.capacity=void 0,e.prototype._hasSavedError=!1,e.prototype._savedError=void 0,e.prototype._savedValues=void 0,e.prototype._saveNextValue=function(a){this.isDone||this._hasSavedError||(this._savedValues||(this._savedValues=[]),this._savedValues.push(a),this.capacity&&this._savedValues.length>this.capacity&&this._savedValues.shift())},e.prototype.sendNext=function(a){c(!this.isDone,"cannot send `next` event on finished Pipe"),this._saveNextValue(a),this._broadcastToOutlets("sendNext",a)},e.prototype.sendError=function(a){c(!this.isDone,"cannot send `error` event on finished Pipe"),this.isDone=!0,this._hasSavedError=!0,this._savedError=a,this._broadcastToOutlets("sendError",a),delete this.outlets},e.prototype.attachOutlet=function(a){var b=this._savedValues;if(b&&b.length)for(var c in b)a.sendNext(b[c]);if(this._hasSavedError)a.sendError(this._savedError);else if(this.isDone)a.sendDone();else var e=d.prototype.attachOutlet.call(this,a);return e},b.exports=e},{"./Inlet":3,"./Pipe":6,"./assert":9,"./schedulers":11}],3:[function(a,b){var c=a("./assert"),d=a("./Pipe"),e=a("./Bond"),f=function(){this.init()};f.prototype=new d,f.prototype.attachOutlet=function(a){c("function"==typeof a.sendNext&&"function"==typeof a.sendError&&"function"==typeof a.sendDone),c(!this.isDone,"cannot attach an outlet to a finished Pipe"),this.outlets||(this.outlets=[]),this.outlets.push(a);var b=this;return new e(function(){b._detachOutlet(a)})},f.prototype.sendNext=function(a){c(!this.isDone,"cannot send next event on finished Pipe"),this._broadcastToOutlets("sendNext",a)},f.prototype.sendError=function(a){c(!this.isDone,"cannot send error event on finished Pipe"),this.isDone=!0,this._broadcastToOutlets("sendError",a),delete this.outlets},f.prototype.sendDone=function(){c(!this.isDone,"cannot send done event on finished Pipe"),this.isDone=!0,this._broadcastToOutlets("sendDone"),delete this.outlets},b.exports=f},{"./Bond":1,"./Pipe":6,"./assert":9}],4:[function(a,b){var c=a("./Bond"),d=function(a){this.init(a)};d.prototype=new c(function(){}),d._bonds=void 0,d.prototype.init=function(a){(this._bonds=a)||(this._bonds=[])},d.prototype.addBond=function(a){this.isBroken?a.break():(this._bonds||(this._bonds=[]),this._bonds.push(a))},d.prototype.break=function(){if(!this.isBroken){this.isBroken=!0;for(var a=0;a<this._bonds.length;a++)this._bonds[a].break();delete this._bonds}},b.exports=d},{"./Bond":1}],5:[function(a,b){var c=a("./assert"),d=a("./Bond"),e=a("./MultiBond"),f=function(a){this.init(a)};f.prototype={init:function(a){var b="function"==typeof a.next,f="function"==typeof a.error,g="function"==typeof a.done;c(b||f||g),b&&(this._nextHandler=a.next),f&&(this._errorHandler=a.error),g&&(this._doneHandler=a.done);var h=this;this.bond=new e([new d(function(){delete h._nextHandler,delete h._errorHandler,delete h._doneHandler})])},_nextHandler:function(){},_errorHandler:function(){},_doneHandler:function(){},sendNext:function(a){this._nextHandler.call(null,a)},sendError:function(a){if(this.hasOwnProperty("_errorHandler")){var b=this._errorHandler;this.bond.break(),b(a)}else this.bond.break()},sendDone:function(){if(this.hasOwnProperty("_doneHandler")){var a=this._doneHandler;this.bond.break(),a()}else this.bond.break()}},b.exports=f},{"./Bond":1,"./MultiBond":4,"./assert":9}],6:[function(a,b){var c,d=a("./assert"),e=a("./Outlet"),f=a("./Bond"),g=(a("./MultiBond"),a("./schedulers")),h=(a("./utils"),function(a){this.init(a)});h.empty=function(){return new h(function(a){a.sendDone()})},h.return=function(a){return new h(function(b){b.sendNext(a),b.sendDone()})},h.fromArray=function(a){return new h(function(b){for(var c=0;c<a.length;c++)b.sendNext(a[c]);b.sendDone()})},h.of=function(){var a=[].slice.call(arguments);return h.fromArray(a)},h.prototype={init:function(a){"function"==typeof a&&(this.onAttach=a)},isDone:!1,onAttach:c,attachOutlet:function(a){if(d("function"==typeof a.sendNext&&"function"==typeof a.sendError&&"function"==typeof a.sendDone),d(!this.isDone,"cannot attach an outlet to a finished Pipe"),!a.bond.isBroken){var b=this;g.scheduleEager(function(){if(!a.bond.isBroken){if(b.onAttach){var c=b.onAttach(a);c instanceof f&&a.bond.addBond(c)}a.bond.isBroken||(b.outlets||(b.outlets=[]),b.outlets.push(a),a.bond.addBond(new f(function(){b._detachOutlet(a)})))}})}},on:function(a){var b=new e(a);return"function"==typeof a.bond&&a.bond.call(null,b.bond),this.attachOutlet(b)},onNext:function(a){return this.on({next:a})},onError:function(a){return this.on({error:a})},onDone:function(a){return this.on({done:a})},_detachOutlet:function(a){if(this.outlets)for(var b=this.outlets.length;b>=0;b--)if(this.outlets[b]===a){this.outlets.splice(b,1);break}},_broadcastToOutlets:function(a,b){if(this.outlets)for(var c in this.outlets){var d=this.outlets[c];try{d[a](b)}catch(e){}}},map:function(a){var b=this;return new h(function(c){b.on({bond:function(a){c.bond.addBond(a)},next:function(b){c.sendNext(a(b))},error:function(a){c.sendError(a)},done:function(){c.sendDone()}})})},mapMerge:function(a){var b=this,c=new h(function(c){var e=[],f=!1,g=function(a){e.push(a),a.on({next:function(a){c.sendNext(a)},error:j,done:function(){i(a)}})},i=function(a){var b=e.indexOf(a);b>-1&&e.splice(b,1),k()},j=function(a){c.sendError(a)},k=function(){var a=!1;return function(){e.length||!f||a||(a=!0,c.sendDone())}}();b.on({next:function(b){if(!f){var c=!1,e=function(){c=!0},i=a(b,e);"undefined"==typeof i||c?c&&(f=!0,k()):(d(i instanceof h),g(i))}},error:j,done:function(){f=!0,k()}})});return c},merge:function(){return this.mapMerge(function(a){return a})},concat:function(){var a,b,d=this,e=!1,f=[],g=function(b){f.push(b),"undefined"==typeof a&&i(),j()},i=function(){if("undefined"==typeof a&&f.length){var d=f.shift();a=d,d.on({bond:function(a){b.bond.addBond(a)},next:function(a){b.sendNext(a)},error:function(a){b.sendError(a)},done:function(){a=c,j(),b.bond.isBroken||i()}})}},j=function(){"undefined"!=typeof a||e!==!0||0!==f.length||b.bond.isBroken||b.sendDone()};return new h(function(a){b=a,d.on({next:function(a){g(a)},error:function(b){a.sendError(b)},done:function(){e=!0,j()}})})},mapConcat:function(a){return this.map(a).concat()},concatWith:function(){var a=this,b=[].slice.call(arguments),c=new h(function(c){a.on({next:function(a){c.sendNext(a)},error:function(a){c.sendError(a)},done:function(){b.length?b.shift().attachOutlet(c):c.sendDone()}})});return c},filter:function(a){return this.mapMerge(function(b){return a(b)?h.return(b):h.empty()})},mapReplace:function(a){return this.map(function(){return a})},skipWhile:function(a){var b=!1;return this.filter(function(c){return b?!0:a(c)?!1:(b=!0,!0)})},skipUntil:function(a){return this.skipWhile(function(b){return!a(b)})},skip:function(a){return this.skipWhile(function(){return a>0?(a-=1,!0):!1})},takeWhile:function(a){return this.mapMerge(function(b,c){return a(b)?h.return(b):(c(),h.empty())})},takeUntilNext:function(a){var b=this;return new h(function(c){a.on({bond:function(a){c.bond.addBond(a)},next:function(a){c.sendDone(a)},error:function(a){c.sendError(a)},done:function(){c.sendDone()}}),b.attachOutlet(c)})},take:function(a){return this.takeWhile(function(){return a>0?(a-=1,!0):!1})},mergeWith:function(){var a=[].slice.call(arguments);return a.unshift(this),new h(function(b){for(var c=a.slice(),d=0;d<a.length;d++)!function(d){var e=a[d];e.on({next:function(a){b.sendNext(a)},error:function(a){b.sendError(a)},done:function(){c.splice(c.indexOf(e),1),0==c.length&&b.sendDone()}})}(d)})},zipWith:function(){var a=[].slice.call(arguments);a.unshift(this);var b=a.length;return new h(function(c){for(var d=new Array(b),e=new Array(b),f=0;b>f;f++)d[f]=!1,e[f]=[];for(var f=0;b>f;f++)!function(f){var g=function(a){e[f].push(a);for(var d=0;b>d;d++)if(!e[d].length)return;var g=[];for(d=0;b>d;d++)g.push(e[d].shift());c.sendNext(g),h()},h=function(){for(var a=0;b>a;a++)d[a]&&!e[a].length&&c.sendDone()};a[f].on({bond:function(a){c.bond.addBond(a)},next:g,error:function(){c.sendError()},done:function(){d[f]=!0,h()}})}(f)})},scan:function(a,b){var c=a;return this.map(function(a){return c=b(c,a)})},scan1:function(a){var b,c=!1;return this.mapConcat(function(d){return c?h.return(b=a(b,d)):(c=!0,b=d,h.empty())})},combineLatestWith:function(){var a=[].slice.call(arguments);a.unshift(this);var b=a.length;return new h(function(d){for(var e=new Array(b),f=new Array(b),g=new Array(b),h=0;b>h;h++)!function(h){e[h]=c,f[h]=!1,g[h]=!1,a[h].on({bond:function(a){d.bond.addBond(a)},next:function(a){f[h]||(f[h]=!0),e[h]=a;for(var c=0;b>c;c++)if(!f[c])return;d.sendNext(e.slice())},error:function(a){d.sendError(a)},done:function(){g[h]=!0;for(var a=0;b>a;a++)if(!g[a])return;d.sendDone()}})}(h)})},not:function(){return this.map(function(a){return!a})},and:function(a){return this.combineLatestWith(a).map(function(a){return!!a[0]&&!!a[1]})},or:function(a){return this.combineLatestWith(a).map(function(a){return!!a[0]||!!a[1]})},filterAdjacent:function(a){return this.filter(function(){var b,c=!1;return function(d){return c?a(b,d)?(b=d,!0):!1:(c=!0,b=d,!0)}}())},dedupe:function(){return this.filterAdjacent(function(a,b){return a!==b})},deliverOn:function(a){var b=this;return new h(function(c){return b.on({next:function(b){a.schedule(function(){c.sendNext(b)})},error:function(b){a.schedule(function(){c.sendError(b)})},done:function(){a.schedule(function(){c.sendDone()})}})})}},b.exports=h},{"./Bond":1,"./MultiBond":4,"./Outlet":5,"./assert":9,"./schedulers":11,"./utils":12}],7:[function(a,b){var c,d=a("./assert"),e=a("./Pipe"),f=a("./MultiBond"),g=a("./Bond"),h=a("./schedulers"),i=h.AsyncScheduler,j=function(){this.init()};j.prototype=new e,j.statusTypePending=1,j.statusTypeFulfilled=2,j.statusTypeRejected=3,j.fulfilled=function(a){var b=new j;return b.status=j.statusTypeFulfilled,b.value=a,b},j.rejected=function(a){var b=new j;return b.status=j.statusTypeRejected,b.reason=a,b},j.prototype.status=j.statusTypePending,j.prototype.value=c,j.prototype.reason=c,j.prototype.init=function(){},j.prototype.attachOutlet=function(a){var b=this,c=new f;return i.schedule(function(){c.isBroken||(b.status===j.statusTypePending?(b.outlets||(b.outlets=[]),b.outlets.push(a),c.addBond(new g(function(){b._detachOutlet(a)}))):b.status===j.statusTypeFulfilled?i.schedule(function(){c.isBroken||a.sendNext(b.value)}):b.status===j.statusTypeRejected&&i.schedule(function(){c.isBroken||a.sendError(b.reason)}))}),c},j.prototype.then=function(a,b){var c=new j,d=function(a,b,c,d){var e;if("function"==typeof a){try{e=a(b)}catch(f){return d.reject(f),void 0}d.resolve(e)}else d[c?"fulfill":"reject"](b)};return this.on({next:function(b){d(a,b,!0,c)},error:function(a){d(b,a,!1,c)}}),c},j.prototype.sendNext=function(a){d(this.status===j.statusTypePending,"can only fulfill a pending Promise");var b=this;i.schedule(function(){b.status===j.statusTypePending&&(b.status=j.statusTypeFulfilled,b.value=a,b._broadcastToOutlets("sendNext",a),b.isDone=!0,b._broadcastToOutlets("sendDone"),delete b.outlets)})},j.prototype.sendError=function(a){d(this.status===j.statusTypePending,"can only reject a pending Promise");var b=this;i.schedule(function(){b.status===j.statusTypePending&&(b.status=j.statusTypeRejected,b.reason=a,b.isDone=!0,b._broadcastToOutlets("sendError",a),delete b.outlets)})},j.prototype.sendDone=function(){d(this.status!==j.statusTypePending&&!this.isDone,"can only finish a fulfilled or rejected Promise"),e.prototype.sendDone.call(this)};var k=function l(a,b){if(d(a.status=j.statusTypePending,"can only resolve a pending Promise"),b===a)return a.reject(new TypeError("promise cycle detected")),void 0;if(b===Object(b)){var c;try{c=b.then}catch(e){return a.reject(e),void 0}if("function"==typeof c){var f=!1;try{c.call(b,function(b){if(!f){f=!0;try{l(a,b)}catch(c){}}},function(b){if(!f){f=!0;try{a.reject(b)}catch(c){}}})}catch(e){i.schedule(function(){f||a.reject(e)})}return}}a.fulfill(b)};j.prototype.fulfill=j.prototype.sendNext,j.prototype.reject=j.prototype.sendError,j.prototype.resolve=function(a){k(this,a)},b.exports=j},{"./Bond":1,"./MultiBond":4,"./Pipe":6,"./assert":9,"./schedulers":11}],8:[function(a,b){var c=a("./assert"),d=(a("./Pipe"),a("./Inlet")),e=(a("./schedulers"),function(a){return this._currentValue=a,this});e.prototype=new d,e.prototype._currentValue=void 0,e.prototype.currentValue=function(){return this._currentValue},e.prototype.attachOutlet=function(a){var b=d.prototype.attachOutlet.call(this,a);if(!b.isBroken)return a.sendNext(this._currentValue),b},e.prototype.sendNext=function(a){c(!this.isDone,"cannot send `next` event on finished Pipe"),this._currentValue=a,this._broadcastToOutlets("sendNext",a)},b.exports=e},{"./Inlet":3,"./Pipe":6,"./assert":9,"./schedulers":11}],9:[function(a,b){b.exports=function(a,b){if(!a)throw new TypeError(b)}},{}],10:[function(a,b){var c=a("./Pipe"),d=a("./Inlet"),e=a("./HistoryInlet"),f=a("./PropertyInlet"),g=a("./Outlet"),h=a("./Promise"),i=a("./Bond"),j=a("./MultiBond"),k=a("./schedulers");b.exports={Pipe:c,Inlet:d,HistoryInlet:e,PropertyInlet:f,Outlet:g,Promise:h,Bond:i,MultiBond:j,SyncScheduler:k.SyncScheduler,AsyncScheduler:k.AsyncScheduler,currentScheduler:k.currentScheduler,schedule:k.schedule}},{"./Bond":1,"./HistoryInlet":2,"./Inlet":3,"./MultiBond":4,"./Outlet":5,"./Pipe":6,"./Promise":7,"./PropertyInlet":8,"./schedulers":11}],11:[function(a,b){var c,d=function(){return c||e()},e=function(){return j},f=function(a){d().schedule(a)},g=function(a){d().scheduleEager(a)},h=function(a,b){if(c===a)return b(),void 0;var d=c;c=a;try{b()}finally{c=d}},i={schedule:function(a){a()},scheduleEager:function(a){a()}},j=function(){var a=[],b=!1,c=!1,d=function(){h(j,function(){for(c=!0;a.length;){var d=a.shift();f(d)}c=!1,b=!1})},e=function(){b||(g(d),b=!0)},f=function(a){try{a()}catch(b){console.log(b.stack)}},g=function(){if("undefined"!=typeof process&&"undefined"==typeof process.nextTick)return process.nextTick;if("function"==typeof setImmediate)return setImmediate;if("function"==typeof setTimeout)return function(a){setTimeout(a,1)};throw new Exception("this environment does not have a supported method of asynchronously scheduling a function invocation")}();return{schedule:function(b){a.push(b),e()},scheduleEager:function(b){c?f(b):(a.push(b),e())}}}();b.exports={schedule:f,scheduleEager:g,currentScheduler:d,SyncScheduler:i,AsyncScheduler:j}},{}],12:[function(a,b){var c=!1,d=function(){c&&console.log.apply(console,[].slice.call(arguments))};b.exports={debug:d}},{}]},{},[10])(10)});