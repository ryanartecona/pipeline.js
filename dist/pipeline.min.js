/*! pipeline - v0.0.1 - 2014-02-18
* Copyright (c) 2014 Ryan Artecona; Licensed BSD-3-Clause */
!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.PL=a.Pipeline=b()}(this,function(){var a,b,c;return function(d){function e(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=s.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(n=n.slice(0,n.length-1),a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(a,b){return function(){return n.apply(d,v.call(arguments,0).concat([a,b]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(a){if(e(r,a)){var b=r[a];delete r[a],t[a]=!0,m.apply(d,b)}if(!e(q,a)&&!e(t,a))throw new Error("No "+a);return q[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(a,b,c,f){var h,k,l,m,n,s,u=[],v=typeof c;if(f=f||a,"undefined"===v||"function"===v){for(b=!b.length&&c.length?["require","exports","module"]:b,n=0;n<b.length;n+=1)if(m=o(b[n],f),k=m.f,"require"===k)u[n]=p.require(a);else if("exports"===k)u[n]=p.exports(a),s=!0;else if("module"===k)h=u[n]=p.module(a);else if(e(q,k)||e(r,k)||e(t,k))u[n]=j(k);else{if(!m.p)throw new Error(a+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=c?c.apply(q[a],u):void 0,a&&(h&&h.exports!==d&&h.exports!==q[a]?q[a]=h.exports:l===d&&s||(q[a]=l))}else a&&(q[a]=c)},a=b=n=function(a,b,c,e,f){if("string"==typeof a)return p[a]?p[a](b):j(o(a,b).f);if(!a.splice){if(s=a,s.deps&&n(s.deps,s.callback),!b)return;b.splice?(a=b,b=c,c=null):a=d}return b=b||function(){},"function"==typeof c&&(c=e,e=f),e?m(d,a,b,c):setTimeout(function(){m(d,a,b,c)},4),n},n.config=function(a){return n(a)},a._defined=q,c=function(a,b,c){b.splice||(c=b,b=[]),e(q,a)||e(r,a)||(r[a]=[a,b,c])},c.amd={jQuery:!0}}(),c("../node_modules/almond/almond",function(){}),c("assert",["require","exports","module"],function(a,b,c){c.exports=function(a,b){if(!a)throw new TypeError(b)}}),c("Bond",["require","exports","module","./assert"],function(a,b,c){var d=a("./assert"),e=function(a){this.init(a)};e.prototype.isBroken=!1,e.prototype._userBreakHandler=function(){},e.prototype.init=function(a){d("function"==typeof a,"Bond can only be constructed with a break handler function."),this._userBreakHandler=a},e.prototype.break=function(){this.isBroken||(this.isBroken=!0,this._userBreakHandler(),delete this.userBreakHandler)},c.exports=e}),c("MultiBond",["require","exports","module","./Bond"],function(a,b,c){var d=a("./Bond"),e=function(a){this.init(a)};e.prototype=new d(function(){}),e._bonds=void 0,e.prototype.init=function(a){(this._bonds=a)||(this._bonds=[])},e.prototype.addBond=function(a){this.isBroken?a.break():(this._bonds||(this._bonds=[]),this._bonds.push(a))},e.prototype.break=function(){if(!this.isBroken){this.isBroken=!0;for(var a=0;a<this._bonds.length;a++)this._bonds[a].break();delete this._bonds}},c.exports=e}),c("Outlet",["require","exports","module","./assert","./Bond","./MultiBond"],function(a,b,c){var d=a("./assert"),e=a("./Bond"),f=a("./MultiBond"),g=function(a){this.init(a)};g.prototype={init:function(a){var b="function"==typeof a.next,c="function"==typeof a.error,g="function"==typeof a.done;d(b||c||g),b&&(this._nextHandler=a.next),c&&(this._errorHandler=a.error),g&&(this._doneHandler=a.done);var h=this;this._bond=new f([new e(function(){delete h._nextHandler,delete h._errorHandler,delete h._doneHandler})])},_nextHandler:function(){},_errorHandler:function(){},_doneHandler:function(){},sendNext:function(a){this._nextHandler.call(null,a)},sendError:function(a){if(this.hasOwnProperty("_errorHandler")){var b=this._errorHandler;this._bond.break(),b(a)}},sendDone:function(){if(this.hasOwnProperty("_doneHandler")){var a=this._doneHandler;this._bond.break(),a()}},attachedWithBond:function(a){this._bond.addBond(a)}},c.exports=g}),c("ProxyOutlet",["require","exports","module","./assert"],function(a,b,c){var d=(a("./assert"),function(a,b){this.outlet=a,this.bond=b,this.outlet.attachedWithBond(b)});d.prototype.sendNext=function(a){this.bond.isBroken||this.outlet.sendNext(a)},d.prototype.sendError=function(a){this.bond.isBroken||this.outlet.sendError(a)},d.prototype.sendDone=function(){this.bond.isBroken||this.outlet.sendDone()},d.prototype.attachedWithBond=function(a){a!==this.bond&&this.bond.addBond(a)},c.exports=d}),c("schedulers",["require","exports","module"],function(a,b,c){var d,e=function(){return d||h},f=function(a){e().schedule(a)},g=function(a,b){if(d===a)return b(),void 0;prevScheduler=d,d=a;try{b()}finally{d=prevScheduler}},h={schedule:function(a){a()}},i=function(){var a=[],b=!1,c=!1,d=function(){g(i,function(){for(c=!0;a.length;){job=a.shift();try{job()}catch(d){}}c=!1,b=!1})},e=function(){b||(f(d),b=!0)},f=function(){if("undefined"!=typeof process&&"undefined"==typeof process.nextTick)return process.nextTick;if("function"==typeof setImmediate)return setImmediate;if("function"==typeof setTimeout)return function(a){setTimeout(a,1)};throw new Exception("this environment does not have a supported method of asynchronously scheduling a function invocation")}();return{schedule:function(b){a.push(b),e()}}}(),j={schedule:function(a){"undefined"!=typeof d?a():i.schedule(a)}};c.exports={schedule:f,currentScheduler:e,SyncScheduler:h,AsyncScheduler:i,AttachmentScheduler:j}}),c("utils",["require","exports","module"],function(a,b,c){var d=!1,e=function(){d&&console.log.apply(console,[].slice.call(arguments))};c.exports={debug:e}}),c("Pipe",["require","exports","module","./assert","./Outlet","./Bond","./MultiBond","./ProxyOutlet","./schedulers","./utils"],function(a,b,c){var d,e=a("./assert"),f=a("./Outlet"),g=a("./Bond"),h=a("./MultiBond"),j=a("./ProxyOutlet"),k=a("./schedulers"),l=k.AttachmentScheduler,m=(a("./utils"),function(a){this.init(a)});m.empty=function(){return new m(function(a){a.sendDone()})},m.return=function(a){return new m(function(b){b.sendNext(a),b.sendDone()})},m.fromArray=function(a){return new m(function(b){for(var c=0;c<a.length;c++)b.sendNext(a[c]);b.sendDone()})},m.of=function(){return args=[].slice.call(arguments),m.fromArray(args)},m.prototype={init:function(a){"function"==typeof a&&(this.onAttach=a)},isDone:!1,onAttach:d,attachOutlet:function(a){e("function"==typeof a.sendNext&&"function"==typeof a.sendError&&"function"==typeof a.sendDone),e(!this.isDone,"cannot attach an outlet to a finished Pipe"),this.outlets||(this.outlets=[]);var b=this,c=new h,d=new j(a,c);return l.schedule(function(){if(!c.isBroken){if(b.onAttach){var a=b.onAttach(d);a instanceof g&&c.addBond(a)}c.isBroken||(b.outlets||(this.outlets=[]),b.outlets.push(d),c.addBond(new g(function(){b._detachOutlet(d)})))}}),c},on:function(a){return this.attachOutlet(new f(a))},onNext:function(a){return this.on({next:a})},onError:function(a){return this.on({error:a})},onDone:function(a){return this.on({done:a})},_detachOutlet:function(a){if(this.outlets)for(var b=this.outlets.length;b>=0;b--)if(this.outlets[b]===a){this.outlets.splice(b,1);break}},_broadcastToOutlets:function(a,b){if(this.outlets)for(i in this.outlets){outlet=this.outlets[i];try{outlet[a](b)}catch(c){}}},map:function(a){var b=this,c=new m(function(c){b.on({next:function(b){c.sendNext(a(b))},error:function(a){c.sendError(a)},done:function(){c.sendDone()}})});return c},mbind:function(a){var b=this,c=new m(function(c){var d=[],f=!1,g=function(a){d.push(a),a.on({next:function(a){c.sendNext(a)},error:i,done:function(){h(a)}})},h=function(a){var b=d.indexOf(a);b>-1&&d.splice(b,1),j()},i=function(a){c.sendError(a)},j=function(){var a=!1;return function(){d.length||!f||a||(a=!0,c.sendDone())}}();b.on({next:function(b){if(!f){var c=!1,d=function(){c=!0},h=a(b,d);"undefined"==typeof h||c?c&&(f=!0,j()):(e(h instanceof m),g(h))}},error:i,done:function(){f=!0,j()}})});return c},concat:function(){var a=this,b=[].slice.call(arguments),c=new m(function(c){a.on({next:function(a){c.sendNext(a)},error:function(a){c.sendError(a)},done:function(){b.length?b.shift().attachOutlet(c):c.sendDone()}})});return c},filter:function(a){return this.mbind(function(b){return a(b)?m.return(b):m.empty()})},skipWhile:function(a){var b=!1;return this.filter(function(c){return b?!0:a(c)?!1:(b=!0,!0)})},skipUntil:function(a){return this.skipWhile(function(b){return!a(b)})},skip:function(a){return this.skipWhile(function(){return a>0?(a-=1,!0):!1})},takeWhile:function(a){return this.mbind(function(b,c){return a(b)?m.return(b):(c(),m.empty())})},takeUntil:function(a){return this.takeWhile(function(b){return!a(b)})},take:function(a){return this.takeWhile(function(){return a>0?(a-=1,!0):!1})},merge:function(){var a=[].slice.call(arguments);return a.unshift(this),new m(function(b){for(var c=a.slice(),d=0;d<a.length;d++)!function(d){var e=a[d];e.on({next:function(a){b.sendNext(a)},error:function(a){b.sendError(a)},done:function(){c.splice(c.indexOf(e),1),0==c.length&&b.sendDone()}})}(d)})},deliverOn:function(a){var b=this;return new m(function(c){return b.on({next:function(b){a.schedule(function(){c.sendNext(b)})},error:function(b){a.schedule(function(){c.sendError(b)})},done:function(){a.schedule(function(){c.sendDone()})}})})}},c.exports=m}),c("Inlet",["require","exports","module","./assert","./Pipe","./Bond"],function(a,b,c){var d=a("./assert"),e=a("./Pipe"),f=a("./Bond"),g=function(){this.init()};g.prototype=new e,g.prototype.attachOutlet=function(a){d("function"==typeof a.sendNext&&"function"==typeof a.sendError&&"function"==typeof a.sendDone),d(!this.isDone,"cannot attach an outlet to a finished Pipe"),this.outlets||(this.outlets=[]),this.outlets.push(a);var b=this;return new f(function(){b._detachOutlet(a)})},g.prototype.sendNext=function(a){d(!this.isDone,"cannot send next event on finished Pipe"),this._broadcastToOutlets("sendNext",a)},g.prototype.sendError=function(a){d(!this.isDone,"cannot send error event on finished Pipe"),this.isDone=!0,this._broadcastToOutlets("sendError",a),delete this.outlets},g.prototype.sendDone=function(){d(!this.isDone,"cannot send done event on finished Pipe"),this.isDone=!0,this._broadcastToOutlets("sendDone"),delete this.outlets},c.exports=g}),c("HistoryInlet",["require","exports","module","./assert","./Pipe","./Inlet","./schedulers"],function(a,b,c){var d=a("./assert"),e=(a("./Pipe"),a("./Inlet")),f=a("./schedulers"),g=(f.AttachmentScheduler,function(a){return"undefined"==typeof a&&(a=0),d("number"==typeof a&&a>=0,"HistoryInlet can only be constructed with an integer capacity."),this.capacity=Math.floor(a),this});g.prototype=new e,g.prototype.capacity=void 0,g.prototype._hasSavedError=!1,g.prototype._savedError=void 0,g.prototype._savedValues=void 0,g.prototype._saveNextValue=function(a){this.isDone||this._hasSavedError||(this._savedValues||(this._savedValues=[]),this._savedValues.push(a),this.capacity&&this._savedValues.length>this.capacity&&this._savedValues.shift())},g.prototype.sendNext=function(a){d(!this.isDone,"cannot send `next` event on finished Pipe"),this._saveNextValue(a),this._broadcastToOutlets("sendNext",a)},g.prototype.sendError=function(a){d(!this.isDone,"cannot send `error` event on finished Pipe"),this.isDone=!0,this._hasSavedError=!0,this._savedError=a,this._broadcastToOutlets("sendError",a),delete this.outlets},g.prototype.attachOutlet=function(a){var b=this._savedValues;if(b&&b.length)for(i in b)a.sendNext(b[i]);if(this._hasSavedError)a.sendError(this._savedError);else if(this.isDone)a.sendDone();else var c=e.prototype.attachOutlet.call(this,a);return c},c.exports=g}),c("PropertyInlet",["require","exports","module","./assert","./Pipe","./Inlet","./schedulers"],function(a,b,c){var d=a("./assert"),e=(a("./Pipe"),a("./Inlet")),f=a("./schedulers"),g=(f.AttachmentScheduler,function(a){return this._currentValue=a,this});g.prototype=new e,g.prototype._currentValue=void 0,g.prototype.currentValue=function(){return this._currentValue},g.prototype.attachOutlet=function(a){var b=e.prototype.attachOutlet.call(this,a);if(!b.isBroken)return a.sendNext(this._currentValue),b},g.prototype.sendNext=function(a){d(!this.isDone,"cannot send `next` event on finished Pipe"),this._currentValue=a,this._broadcastToOutlets("sendNext",a)},c.exports=g}),c("Promise",["require","exports","module","./assert","./Pipe","./MultiBond","./Bond","./schedulers"],function(a,b,c){var d,e=a("./assert"),f=a("./Pipe"),g=a("./MultiBond"),h=a("./Bond"),i=a("./schedulers"),j=i.AttachmentScheduler,k=i.AsyncScheduler,l=function(){this.init()};l.prototype=new f,l.statusTypePending=1,l.statusTypeFulfilled=2,l.statusTypeRejected=3,l.fulfilled=function(a){var b=new l;return b.status=l.statusTypeFulfilled,b.value=a,b},l.rejected=function(a){var b=new l;return b.status=l.statusTypeRejected,b.reason=a,b},l.prototype.status=l.statusTypePending,l.prototype.value=d,l.prototype.reason=d,l.prototype.init=function(){},l.prototype.attachOutlet=function(a){var b=this,c=new g;return j.schedule(function(){c.isBroken||(b.status===l.statusTypePending?(b.outlets||(b.outlets=[]),b.outlets.push(a),c.addBond(new h(function(){b._detachOutlet(a)}))):b.status===l.statusTypeFulfilled?k.schedule(function(){c.isBroken||a.sendNext(b.value)}):b.status===l.statusTypeRejected&&k.schedule(function(){c.isBroken||a.sendError(b.reason)}))}),c},l.prototype.then=function(a,b){var c=new l,d=function(a,b,c,d){var e;if("function"==typeof a){try{e=a(b)}catch(f){return d.reject(f),void 0}d.resolve(e)}else d[c?"fulfill":"reject"](b)};return this.on({next:function(b){d(a,b,!0,c)},error:function(a){d(b,a,!1,c)}}),c},l.prototype.sendNext=function(a){e(this.status===l.statusTypePending,"can only fulfill a pending Promise");var b=this;k.schedule(function(){b.status===l.statusTypePending&&(b.status=l.statusTypeFulfilled,b.value=a,b._broadcastToOutlets("sendNext",a),b.isDone=!0,b._broadcastToOutlets("sendDone"),delete b.outlets)})},l.prototype.sendError=function(a){e(this.status===l.statusTypePending,"can only reject a pending Promise");var b=this;k.schedule(function(){b.status===l.statusTypePending&&(b.status=l.statusTypeRejected,b.reason=a,b.isDone=!0,b._broadcastToOutlets("sendError",a),delete b.outlets)})},l.prototype.sendDone=function(){e(this.status!==l.statusTypePending&&!this.isDone,"can only finish a fulfilled or rejected Promise"),f.prototype.sendDone.call(this)};var m=function n(a,b){if(e(a.status=l.statusTypePending,"can only resolve a pending Promise"),b===a)return a.reject(new TypeError("promise cycle detected")),void 0;if(b===Object(b)){var c;try{c=b.then}catch(d){return a.reject(d),void 0}if("function"==typeof c){var f=!1;try{c.call(b,function(b){if(!f){f=!0;try{n(a,b)}catch(c){}}},function(b){if(!f){f=!0;try{a.reject(b)}catch(c){}}})}catch(d){k.schedule(function(){f||a.reject(d)})}return}}a.fulfill(b)};l.prototype.fulfill=l.prototype.sendNext,l.prototype.reject=l.prototype.sendError,l.prototype.resolve=function(a){m(this,a)},c.exports=l}),c("pipeline",["require","exports","module","./Pipe","./Inlet","./HistoryInlet","./PropertyInlet","./Outlet","./Promise","./Bond","./MultiBond","./schedulers"],function(a,b,c){var d=a("./Pipe"),e=a("./Inlet"),f=a("./HistoryInlet"),g=a("./PropertyInlet"),h=a("./Outlet"),i=a("./Promise"),j=a("./Bond"),k=a("./MultiBond"),l=a("./schedulers");c.exports={Pipe:d,Inlet:e,HistoryInlet:f,PropertyInlet:g,Outlet:h,Promise:i,Bond:j,MultiBond:k,SyncScheduler:l.SyncScheduler,AsyncScheduler:l.AsyncScheduler,currentScheduler:l.currentScheduler,schedule:l.schedule}}),b("pipeline")});